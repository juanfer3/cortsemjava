<?php

/*
 * To change this license header, choose License Headers in Project Properties.
 * To change this template file, choose Tools | Templates
 * and open the template in the editor.
 */

/**
 * Description of Usuario
 *
 * @author USUARIO
 */
include_once ("Conexion.php"); //utilizar include_once para que el script de la pagina se cargue una vez
//include "ConexionPDO.php";

mysqli_report(MYSQLI_REPORT_ERROR | MYSQLI_REPORT_STRICT);

class Usuario {

    public $usuario;
    public $contrasena;
    public $rol;
    public $habilitado;
    public $con;
    public $id;

    public function __construct() {
        $this->con = new Conexion();
    }

    public function insertarUsuario($usuario, $contrasena, $rol) {

        $habilitado = "si";
        $sql = "INSERT INTO usuarios(usuario,contrasena,rol,habilitado)VALUES('$usuario','$contrasena','$rol','$habilitado');";
        try {

            $rs = $this->con->query($sql) ? $r = 'Insertado' : $r = 'Insercion fallida ;(';
            print_r($r);
        } catch (Exception $e) {
            echo 'ERROR:' . $e->getMessage();
        }
    }

    public function ultimoUsuario() {

        try {

            $id = mysqli_insert_id($this->con);
            return $id;
        } catch (Exception $e) {
            echo 'ERROR:' . $e->getMessage();
        }
    }

    public function Paginacion() {

        try {
            $habilitado = "si";
            $sql = "SELECT * FROM usuarios WHERE habilitado='$habilitado'";
            

            $rs = $rs = $this->con->query($sql);
            $cantidad = mysqli_num_rows($rs);
            $con = null;
            return $cantidad;
        } catch (Exception $e) {
            echo 'ERROR:' . $e->getMessage();
        }
    }

    public function UpdateUser($usuario, $contrasena, $rol) {



        try {

            $sql = "UPDATE usuarios SET usuario='$usuario',contrasena='$contrasena',rol='$rol WHERE id='$id';";
            $rs = $this->con->query($sql) ? $r = 'Update Exitoso' : $r = 'Update fallido ;(';
        } catch (Exception $exc) {
            echo'Error en el Update' . $exc->getMessage();
        }
    }

    public function getUsersById($id){
        
            $sql="SELECT * FROM usuarios WHERE id='$id';";
            $rs=$this->con->query($sql);
             if($rs->num_rows > 0){
                 $data = array();
                 while($row= $rs->fetch_assoc()){
                     $data= $row;
                 }
             }else{
                 echo 'no hay resultados con el criterio de busqueda';
             }
        echo json_encode($data);
    }
    
}
